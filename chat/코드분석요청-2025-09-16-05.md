### 목적

- **요청**: 리팩토링 전, `src` 폴더 내 코드의 동작을 상세 분석
- **대상**: `src/converter.h`, `src/converter.cpp`, `src/main.cpp` (+ 참고: 루트 `unit_converter.cpp`)

### 파일 구성과 역할

- **`src/converter.h`**: 길이 단위 열거형 `LengthUnit`, 파싱/변환 API 선언, 결과 구조체 `LengthTriple` 정의
- **`src/converter.cpp`**: 입력 파싱(`parseInput`), 단위 문자열 매핑(`unitFromString`), 미터 환산(`toMeters`), 3단 변환(`computeTripleFromMeters`) 구현
- **`src/main.cpp`**: CLI 입출력. 사용자의 `unit:value` 입력을 받아 파싱 → 단위 매핑 → 미터 환산 → feet/yard 계산 → 결과 출력
- (참고) **`unit_converter.cpp`**: 과거 단일 파일 버전. 현재 CMake 빌드에 포함되지 않은 레거시(로 보임)

### 런타임 데이터 흐름(엔드 투 엔드)

1. 사용자가 콘솔에 `unit:value` 형태로 입력 (예: `meter:2.5`)
2. `parseInput`가 문자열을 `:` 기준으로 분리하여
   - 단위 문자열을 소문자화하여 `unitString`에 저장
   - `std::stod`로 값 부분을 실수로 파싱해 `value`에 저장
3. `unitFromString`이 `unitString`을 `LengthUnit`으로 매핑(알 수 없는 단위면 예외 throw)
4. `toMeters`가 매핑된 단위 기준으로 값을 미터 단위로 환산
5. `computeTripleFromMeters`가 미터값을 가지고 3가지 표현(m, ft, yd)으로 계산
6. 원 입력값과 단위 문자열을 사용하여 3줄의 결과를 콘솔에 출력

### 핵심 상수/단위 정의

- 1 m = 3.28084 ft
- 1 m = 1.09361 yd
- feet→meter: value / 3.28084, yard→meter: value / 1.09361

### 함수별 상세 동작

- **`parseInput(const std::string&, std::string&, double&) -> bool`**
  - 형식: `unit:value`를 기대. 콜론 위치 점검(앞/뒤 공란/누락 방지)
  - 단위 부분을 소문자화(`toLowerCopy`)해 반환, 값은 `std::stod`로 파싱
  - 형식 오류나 숫자 파싱 실패 시 `false`

```15:27:c:\BestReviewer\UnitConverterAI_Init\src\converter.cpp
bool parseInput(const std::string& input, std::string& unitString, double& value) {
    std::size_t colonPos = input.find(":");
    if (colonPos == std::string::npos || colonPos == 0 || colonPos + 1 >= input.size()) {
        return false;
    }
    unitString = toLowerCopy(input.substr(0, colonPos));
    try {
        value = std::stod(input.substr(colonPos + 1));
    } catch (...) {
        return false;
    }
    return true;
}
```

- **`unitFromString(const std::string&) -> LengthUnit`**
  - 허용 별칭(소문자 전제):
    - meter: `meter`, `meters`, `m`
    - feet: `feet`, `foot`, `ft`
    - yard: `yard`, `yards`, `yd`
  - 미일치 시 `std::invalid_argument` 예외 발생

```29:39:c:\BestReviewer\UnitConverterAI_Init\src\converter.cpp
LengthUnit unitFromString(const std::string& unitLower) {
    if (unitLower == "meter" || unitLower == "meters" || unitLower == "m") {
        return LengthUnit::Meter;
    }
    if (unitLower == "feet" || unitLower == "foot" || unitLower == "ft") {
        return LengthUnit::Feet;
    }
    if (unitLower == "yard" || unitLower == "yards" || unitLower == "yd") {
        return LengthUnit::Yard;
    }
    throw std::invalid_argument("Unknown unit: " + unitLower);
}
```

- **`toMeters(double, LengthUnit) -> double`**

  - `switch`로 단위 분기
  - meter: 그대로 반환, feet/yard: 위 상수로 나누어 미터 환산
  - 정의 외 값은 예외 처리(실제로는 enum 이외 없음)

- **`computeTripleFromMeters(double) -> LengthTriple`**
  - 입력 미터값을 그대로 `inMeters`, `*3.28084`로 feet, `*1.09361`로 yard 계산

### 출력 형식(`main.cpp`)

- 입력 실패/형식 오류/미지원 단위 시 오류 메시지 후 종료 코드 1 반환
- 성공 시 3줄 출력(원래 입력값과 원래 단위 문자열 사용)
  - 예: `2.5 meter = 2.5 meter`, `= 8.2021 feet`, `= 2.732... yard`

### 테스트(`tset/converter_tests.cpp`)와의 매핑

- `ParseInput.ValidExamples`/`InvalidExamples`: 형식/대소문자 처리/숫자 파싱 정상성 확인
- `UnitMapping.KnownUnits`/`UnknownUnitThrows`: 별칭 매핑과 예외 확인
- `Conversions.ToMeters`/`TripleFromMeters`: 변환 상수 및 정밀도(NEAR/DOUBLE_EQ) 검증

### 예외/에러 처리 전략

- 파싱 실패: `false` 반환으로 상위(메인)에서 메시지 출력 후 종료
- 단위 미지원: `invalid_argument` 예외를 메인에서 받아 메시지 출력 후 종료
- 숫자 파싱: `std::stod` 예외는 `parseInput`에서 삼켜서 `false`로 신호

### 참고: 레거시 파일 `unit_converter.cpp`

- 동일 목적의 단일 파일 구현. 공백/에러 처리, 대소문자, 별칭, 예외 처리 측면에서 현재 모듈화된 버전보다 단순
- CMake 빌드 대상 아님(현 빌드 산출물: `build/libconverter.a`, `build/unit_converter.exe`)

### 경계 조건 및 동작 요약

- 공백 트리밍 미적용: 입력 앞/뒤/사이에 공백이 있으면 실패할 수 있음
- 로케일: `std::stod`는 현재 로케일 영향을 받을 수 있음(소수점 기호 등)
- 음수/0 값: 제약 없음, 그대로 변환
- 출력 자릿수/반올림: 명시적 설정 없음(iostream 기본 포맷)

### 리팩토링 전에 알아두면 좋은 개선 포인트(요약)

- 입력 공백 트리밍, 상세 오류 메시지 구분(형식/숫자/단위)
- 변환 상수 `constexpr`화 및 중앙집중 관리, 양방향 변환 유틸 추가
- 출력 포맷(고정 소수점, 자릿수), 단위 복수형 처리(feet/yard 단수/복수)
- I/O와 변환 로직 분리 강화(현재도 분리되어 양호함), 레거시 파일 정리
- 추가 단위 확장 용이성(예: inch, cm, km) 위한 맵 기반 전략 고려

### 빌드/실행(참고)

- 규칙에 따라 `build` 폴더에서 CMake/Make 사용
- 실행 파일: `build/unit_converter.exe`
- 테스트: `build/tset/converter_tests` 경유로 `ctest` 실행 가능

---

본 문서는 현재 코드의 실제 동작을 기준으로 정리되었습니다. 리팩토링 시 위 개선 포인트를 우선 검토하면 기능 보존과 확장성을 동시에 확보할 수 있습니다.

---

### 리팩토링 진행 로그 (2025-09-16)

- 입력 파싱 강화: 공백 트리밍 추가 및 견고성 향상
  - `src/converter.cpp`: `trimInPlace` 도입, `parseInput`가 `unit`/`value`의 앞뒤 공백 제거 후 처리
  - 콜론 기준 분리 후 빈 토큰 방지 검증 추가
- 변환 상수 중앙 관리 및 `constexpr`화
  - `FEET_PER_METER = 3.28084`, `YARDS_PER_METER = 1.09361` 상수를 파일 상단 내부 네임스페이스에 `constexpr`로 정의
  - `toMeters`/`computeTripleFromMeters`가 상수 참조하도록 수정
- 출력 포맷 고정
  - `src/main.cpp`: `std::fixed` + `std::setprecision(6)` 적용으로 일관된 6자리 소수 출력

빌드/테스트 권장 절차(빌드는 `build` 폴더):

- 구성: `cmake -S . -B build -G "Unix Makefiles"`
- 빌드: `cmake --build build -- -j`
- 테스트: `ctest --test-dir build --output-on-failure`

다음 제안 단계:

- 단위 확장 전략(맵 기반) 및 에러 메시지 세분화
- 출력 단위의 단/복수 처리(feet/foot, yard/yards)와 국제화 준비

- 단위 레지스트리 및 확장
  - `src/converter.cpp`: `std::unordered_map` 기반 별칭 레지스트리 도입 → 문자열 단위를 `LengthUnit`으로 안전 매핑
  - 지원 단위 확장: centimeter(cm), kilometer(km), inch(in) 추가
  - `toMeters`에 cm/km/in 변환 경로 추가
- 에러 메시지 세분화

  - 알 수 없는 단위에 대해 지원 단위 목록을 포함한 메시지 제공

- GitHub 동기화 준비
  - 로컬 git 초기화/커밋 예정. 원격 URL 및 사용자 정보 설정 필요
  - 예정 명령: `git init -b main && git add -A && git commit -m "refactor: ..." && git remote add origin <URL> && git push -u origin main`
